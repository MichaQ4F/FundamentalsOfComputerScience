## 概述
计算机系统由计算机硬件和运行在硬件上的软件构成。
软件包括运行在硬件上的程序和数据以及相关的文档。
程序是指挥计算机如何操作的一个指令序列。
数据是指令操作的对象
## 1.1.1 计算机硬件
冯·诺依曼结构计算机特征及其基本思想：
1. 采用"存储程序"工作方式
2. 计算机由运算器、控制器、存储器、输入设备和输出设备5个基本部件组成
3. 存储器可存放指令和数据。指令和数据形式上无区别。控制器能控制指令自动执行。运算器能进行加减乘除基本算术运算和逻辑运算。
4. 计算机内部以二进制形式表示指令和数据。指令由操作码和地址码组成。操作码指出操作类型，地址码指出操作数的地址。
计算机硬件构成：中央处理器（CPU）、存储器、I/O控制器、外部设备和各类总线。
1. CPU用于执行指令，主要由两部分组成：数据通路和控制器。数据通路包括算数逻辑部件（ALU）和通用寄存器，用来执行算数和逻辑运算操作。控制器对指令进行译码，生成对应控制信号，控制数据通路进行正确操作。
2. 存储器分为内存和外存。内存包括主存(main mermory)和高速缓存(cache)。外存又称为辅存，指机械硬盘或固态硬盘等。
3. 外部设备也称I/O设备
4. 总线（bus）是传输信息的介质，用于在各部件之间传输信息。
## 1.1.2 计算机系统的层次结构
### 概述
计算机系统是层次结构系统，通过向上层用户提供一个抽象的接口将较低层次的实现细节隐藏起来。计算机解决应用问题的过程就是将不同抽象层进行转换的过程。
### 1.1.2.1 计算机系统抽象层的转换
<table>
	<capital>计算机系统抽象层及其转换</capital>
	<tr>
		<th style="text-align : center;" colspan=5>硬件</th>
		<th style="text-align : center;" colspan=5>软件</th>
	</tr>
	<tr>
		<td>器件</td>
		<td>电路</td>
		<td>功能部件/RTL</td>
		<td>微体系结构</td>
		<td colspan=2>指令集体系结构(ISA)</td>
		<td>操作系统/虚拟机</td>
		<td>编程(语言)</td>
		<td>算法</td>
		<td>应用(问题)</td>
	</tr>
	<tr>
		<td style="text-align : center;" colspan=2>电子工程师</td>
		<td style="text-align : center;" colspan=4>架构师</td>
		<td style="text-align : center;" colspan=3>程序员</td>
		<td>最终用户</td>
	</tr>
</table>
## 1.1.3 程序开发与执行过程
### 1.1.3.1 从源程序到可执行程序
以C语言源程序代码`hello.c`为例
```C
#include <stdio.h>
int main()
{
	printf("Hello World!");
}
```
计算机执行这个程序需要以下步骤：
1. 通过程序编辑软件得到`hello.c`文件。该文件在计算机中以`ASCII`码存放。
2. 将hello.c进行预处理、编译、汇编和链接，最终生成可执行目标文件。
	1. 预处理阶段：预处理程序对源程序中以字符`#`开头的命令进行处理，如`#include <stdio.h>`就是将`stdio.h`文件内容嵌入到源程序文件中。
	2. 编译阶段：编译程序对预处理后的源程序进行汇编，生成一个汇编语言源程序文件。
	3. 汇编阶段：汇编程序对汇编语言源程序进行汇编，生成可重定位目标文件。这是一个二进制文件，其代码为机器指令。
	4. 链接阶段：链接程序将多个可重定位目标文件和标准函数库合并为一个可执行目标文件。
### 1.1.3.2 可执行文件的启动和执行(以从shell程序执行为例)
1. 首先将用户从键盘输入的字符逐一读入CPU寄存器中，然后保存到主存中，在主存的缓冲区形成字符串`./hello`，等接受到`Enter`键时，`shell`将调出操作系统内核中相应的服务例程，由内核加载磁盘上的可执行文件到存储器。
2. 内核加载完可执行文件中的代码及其所要处理的数据`(这里是Hello World!\n)`后，将第一条指令的地址送到程序计数器中。CPU永远将程序计数器的内容作为将要执行的指令的地址。处理器开始执行`hello`程序，将主存中的字符串每一个字符从主存取到CPU寄存器中，然后将CPU寄存器中的字符送到显示器上显示出来。
### 1.1.3.3 程序与指令的关系
程序由指令构成。
可执行文件的执行实际上是所包含的机器代码段执行的过程。
指令通常被划分为若干个字段，如操作码字段、地址码字段和立即数字段。操作码字段指出指令的操作类型；地址码字段指出指令所处理的操作数的地址；立即数字段指出具体的一个操作数或偏移地址等。
### 1.1.3.4 指令执行过程
以冯·诺依曼结构的简单模型机为例。
CPU包含：ALU、通用寄存器组(GPRs)、标志寄存器、控制器、指令寄存器(IR)、程序计数器(PC)、存储器地址寄存器(MAR)和存储器数据寄存器(MDR)。
1. ALU：进行算数和逻辑运算。
2. GPRs由多个寄存器构成，每个寄存器都有编号，通过指令制定编号对应的寄存器中的数据作为ALU运算的操作数。
3. 标志寄存器用来存放ALU运算得到的标志信息，如是否为负数、是否为0，有无进位或借位等。
4. IR：存放从主存读出的指令。
5. 控制器：对指令中的操作码进行译码，生成控制信号。
6. CPU和主存间的总线分为地址、控制和数据线。MAR中的地址信息会直接送到地址线上。控制线中有读/写信号线，指出是CPU写入主存还是从主存读到CPU中，这个操作决定MDR的数据送到数据线还是数据线的数据送入MDR。
7. 主存：用来存储指令和操作数。每个存储单元有一个编号，称为地址。通常一个存储单元存放一个字节(8位)。
执行过程：
1. 根据PC取指令到IR：PC将内容送到MAR，MAR中的内容送到地址线，同时控制器将读信号送读/写信号线，主存根据地址线上的地址和控制线上的读信号从指定存储单元读出指令，并送到数据线上。MDR从数据线接受指令信息，并送入到IR中。
2. 指令译码并送出控制信号：控制器根据IR中指令的操作码，生成相应的控制信号，送到不同的执行部件（假设IR中指令为ALU运算指令）。
3. 取操作数：根据IR中指令指定的寄存器编号选择两个或一个寄存器中的内容作为操作数，送入到ALU的输入端。
4. 指令执行：在控制信号控制下进行相应运算，生成运算结果和相应的标志信息。
5. 回写结果：将运算结果写入指定编号寄存器或主存单元。